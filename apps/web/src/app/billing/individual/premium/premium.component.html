<div class="tw-max-w-4xl tw-mx-auto">
  <bit-section *ngIf="shouldShowNewDesign$ | async">
    <div class="tw-max-w-4xl tw-ml-auto tw-mr-16 tw-text-center">
      <div
        class="tw-inline-block tw-bg-background-alt tw-border-[0.5px] tw-border-secondary-700 tw-rounded-full tw-px-2 tw-py-1 tw-mt-8 tw-mb-6"
      >
        <span bitTypography="helper" class="tw-text-secondary-700">
          {{ "bitwardenFreeplanMessage" | i18n }}
        </span>
      </div>

      <h2 *ngIf="!isSelfHost" class="tw-mt-6 tw-text-4xl">
        {{ "upgradeCompleteSecurity" | i18n }}
      </h2>
      <p class="tw-text-muted tw-mb-6">
        {{ "unlockPremiumFeatures" | i18n }}
      </p>
    </div>

    <!-- Two-Card Layout -->
    <div class="tw-grid tw-grid-cols-1 md:tw-grid-cols-2 tw-gap-6 tw-mt-6 tw-justify-center">
      <!-- Premium Card -->
      <div>
        @if (premiumCardData$ | async; as premiumData) {
          <billing-pricing-card
            [tagline]="'planDescPremium' | i18n"
            [price]="{ amount: premiumData.price, cadence: 'monthly' }"
            [button]="{ type: 'primary', text: ('upgradeToPremium' | i18n) }"
            [features]="premiumData.features"
            (buttonClick)="openUpgradeDialog('Premium')"
          >
            <h3 slot="title" bitTypography="h3" class="tw-m-0">{{ "premium" | i18n }}</h3>
          </billing-pricing-card>
        }
      </div>

      <!-- Families Card -->
      <div>
        @if (familiesCardData$ | async; as familiesData) {
          <billing-pricing-card
            [tagline]="'planDescFamiliesV2' | i18n"
            [price]="{ amount: familiesData.price, cadence: 'monthly' }"
            [button]="{ type: 'secondary', text: ('upgradeToFamilies' | i18n) }"
            [features]="familiesData.features"
            (buttonClick)="openUpgradeDialog('Families')"
          >
            <h3 slot="title" bitTypography="h3" class="tw-m-0">{{ "families" | i18n }}</h3>
          </billing-pricing-card>
        }
      </div>
    </div>

    <!-- Business Plans Link -->
    <div class="tw-text-center tw-mt-6">
      <p class="tw-text-muted tw-mb-2">{{ "individualUpgradeTaxInformationMessage" | i18n }}</p>
      <a
        bitLink
        linkType="primary"
        href="https://bitwarden.com/pricing/business/"
        target="_blank"
        rel="noopener noreferrer"
      >
        {{ "viewbusinessplans" | i18n }}
        <i class="bwi bwi-external-link tw-ml-1" aria-hidden="true"></i>
      </a>
    </div>
  </bit-section>
</div>
<!-- Legacy Design (shown when user already has premium access) -->
<div *ngIf="!(shouldShowNewDesign$ | async)">
  <bit-section>
    <h2 *ngIf="!isSelfHost" bitTypography="h2">{{ "goPremium" | i18n }}</h2>
    <bit-callout
      type="info"
      *ngIf="hasPremiumFromAnyOrganization$ | async"
      title="{{ 'youHavePremiumAccess' | i18n }}"
      icon="bwi bwi-star-f"
    >
      {{ "alreadyPremiumFromOrg" | i18n }}
    </bit-callout>
    <bit-callout type="success">
      <p>{{ "premiumUpgradeUnlockFeatures" | i18n }}</p>
      <ul class="bwi-ul">
        <li>
          <i class="bwi bwi-check tw-text-success bwi-li" aria-hidden="true"></i>
          {{ "premiumSignUpStorage" | i18n }}
        </li>
        <li>
          <i class="bwi bwi-check tw-text-success bwi-li" aria-hidden="true"></i>
          {{ "premiumSignUpTwoStepOptions" | i18n }}
        </li>
        <li>
          <i class="bwi bwi-check tw-text-success bwi-li" aria-hidden="true"></i>
          {{ "premiumSignUpEmergency" | i18n }}
        </li>
        <li>
          <i class="bwi bwi-check tw-text-success bwi-li" aria-hidden="true"></i>
          {{ "premiumSignUpReports" | i18n }}
        </li>
        <li>
          <i class="bwi bwi-check tw-text-success bwi-li" aria-hidden="true"></i>
          {{ "premiumSignUpTotp" | i18n }}
        </li>
        <li>
          <i class="bwi bwi-check tw-text-success bwi-li" aria-hidden="true"></i>
          {{ "premiumSignUpSupport" | i18n }}
        </li>
        <li>
          <i class="bwi bwi-check tw-text-success bwi-li" aria-hidden="true"></i>
          {{ "premiumSignUpFuture" | i18n }}
        </li>
      </ul>
      <p bitTypography="body1" [ngClass]="{ 'tw-mb-0': !isSelfHost }">
        {{
          "premiumPriceWithFamilyPlan"
            | i18n: (premiumPrice | currency: "$") : familyPlanMaxUserCount
        }}
        <a
          bitLink
          linkType="primary"
          routerLink="/create-organization"
          [queryParams]="{ plan: 'families' }"
        >
          {{ "bitwardenFamiliesPlan" | i18n }}
        </a>
      </p>
      <a
        bitButton
        href="{{ premiumURL }}"
        target="_blank"
        rel="noreferrer"
        buttonType="secondary"
        *ngIf="isSelfHost"
      >
        {{ "purchasePremium" | i18n }}
      </a>
    </bit-callout>
  </bit-section>
  <bit-section *ngIf="isSelfHost">
    <individual-self-hosting-license-uploader
      (onLicenseFileUploaded)="onLicenseFileSelectedChanged()"
    />
  </bit-section>
  <form *ngIf="!isSelfHost" [formGroup]="addOnFormGroup" [bitSubmit]="submitPayment">
    <bit-section>
      <h2 bitTypography="h2">{{ "addons" | i18n }}</h2>
      <div class="tw-grid tw-grid-cols-12 tw-gap-4">
        <bit-form-field class="tw-col-span-6">
          <bit-label>{{ "additionalStorageGb" | i18n }}</bit-label>
          <input
            bitInput
            formControlName="additionalStorage"
            type="number"
            step="1"
            placeholder="{{ 'additionalStorageGbDesc' | i18n }}"
          />
          <bit-hint>{{
            "additionalStorageIntervalDesc"
              | i18n: "1 GB" : (storageGBPrice | currency: "$") : ("year" | i18n)
          }}</bit-hint>
        </bit-form-field>
      </div>
    </bit-section>
    <bit-section>
      <h2 bitTypography="h2">{{ "summary" | i18n }}</h2>
      {{ "premiumMembership" | i18n }}: {{ premiumPrice | currency: "$" }} <br />
      {{ "additionalStorageGb" | i18n }}: {{ addOnFormGroup.value.additionalStorage || 0 }} GB
      &times; {{ storageGBPrice | currency: "$" }} =
      {{ additionalStorageCost | currency: "$" }}
      <hr class="tw-my-3" />
    </bit-section>
    <bit-section>
      <h3 bitTypography="h2">{{ "paymentInformation" | i18n }}</h3>
      <app-payment [showBankAccount]="false"></app-payment>
      <app-tax-info (taxInformationChanged)="onTaxInformationChanged()"></app-tax-info>
      <div class="tw-mb-4">
        <div class="tw-text-muted tw-text-sm tw-flex tw-flex-col">
          <span>{{ "planPrice" | i18n }}: {{ subtotal | currency: "USD $" }}</span>
          <span>{{ "estimatedTax" | i18n }}: {{ estimatedTax | currency: "USD $" }}</span>
        </div>
      </div>
      <hr class="tw-my-1 tw-w-1/4 tw-ml-0" />
      <p bitTypography="body1">
        <strong>{{ "total" | i18n }}:</strong> {{ total | currency: "USD $" }}/{{ "year" | i18n }}
      </p>
      <button type="submit" buttonType="primary" bitButton bitFormButton>
        {{ "submit" | i18n }}
      </button>
    </bit-section>
  </form>
</div>
